# 小说生成系统使用指南

## 文本输入位置

### 1. 现有输入文件
项目已经包含一个示例输入文件：
- `source/越女剑.txt` - 这是现有的长文本输入文件

### 2. 添加新的输入文件
您可以将自己的长文本文件放在以下位置：

#### 方式一：放在 source/ 目录
```
source/
├── 越女剑.txt          # 现有文件
├── 您的小说.txt       # 您的新文件
├── 古龙小说.txt       # 另一个示例
└── 现代小说.txt       # 现代题材
```

#### 方式二：放在项目根目录
```
您的项目/
├── source/
├── 您的小说.txt       # 直接放在根目录
├── 另一个故事.txt     # 另一个故事
└── novel_generator.py
```

## 使用方法

### 步骤1：配置API密钥

首先编辑 `config.json` 文件，填入您的API密钥：

```json
{
  "api_key": "sk-your-actual-api-key-here",
  "api_base_url": "https://api.openai.com/v1",
  "models": {
    "summary_model": "gpt-4",
    "expansion_model": "gpt-3.5-turbo",
    "default_model": "gpt-3.5-turbo"
  },
  "max_tokens": 2000,
  "temperature": 0.7
}
```

### 步骤2：准备输入文本

确保您的输入文本是UTF-8编码的.txt文件。示例格式：

```
第一章 开始

这是一个故事的开始。在一个遥远的王国里，住着一位年轻的骑士...

第二章 冒险

骑士决定踏上冒险之旅，他穿越了黑暗的森林...
```

### 步骤3：运行处理

#### 基本使用
```bash
# 处理现有的越女剑.txt
python novel_generator.py source/越女剑.txt

# 处理您自己的文件
python novel_generator.py 您的小说.txt
```

#### 高级使用
```bash
# 指定配置文件和输出目录
python novel_generator.py 您的小说.txt --config my_config.json --output results

# 处理多个文件
for file in source/*.txt; do
    python novel_generator.py "$file"
done
```

### 步骤4：查看结果

处理完成后，您会在以下目录找到结果：

```
output/
├── stage1_summary.txt              # 剧情摘要和伏笔
├── stage2_chapter_outlines.txt     # 章节大纲
├── stage3_expanded_chapter.txt     # 1k字扩写
├── stage4_final_chapter.txt        # 2k字最终扩写
├── novel_processing_result.json    # 完整处理结果
└── [时间戳]_stage[阶段]_[内容].txt # 详细输出

logs/
└── novel_generator.log             # 运行日志

failed/
└── chapter_[章节号]_failed.txt     # 处理失败的章节
```

## 实际使用示例

### 示例1：处理越女剑
```bash
# 进入项目目录
cd d:/Project/SoundNovel

# 处理现有文件
python novel_generator.py source/越女剑.txt

# 查看结果
cat output/stage1_summary.txt
cat output/stage2_chapter_outlines.txt
```

### 示例2：处理您自己的小说
```bash
# 创建您的小说文件
echo "第一章 开始的故事
在一个宁静的小村庄里，住着一位年轻的女孩..." > 我的小说.txt

# 处理您的小说
python novel_generator.py 我的小说.txt

# 查看最终生成的章节
cat output/stage4_final_chapter.txt
```

### 示例3：批量处理
```bash
# 创建多个示例文件
echo "第一章 序幕
古老的预言即将实现..." > 预言故事.txt
echo "第一章 起点
城市的霓虹灯下..." > 都市故事.txt

# 批量处理
for file in *.txt; do
    echo "处理 $file..."
    python novel_generator.py "$file"
done
```

## 输出文件详解

### stage1_summary.txt
包含：
- 【剧情摘要】 - 故事的主要情节和脉络
- 【伏笔分析】 - 潜在的剧情转折点和伏笔

### stage2_chapter_outlines.txt
包含：
- 每章的标题和100字左右的大纲
- 基于剧情摘要和伏笔构建的章节结构

### stage3_expanded_chapter.txt
包含：
- 章节大纲扩写到约1000字的内容
- 包含环境描写、人物心理、对话等

### stage4_final_chapter.txt
包含：
- 最终扩写到约2000字的完整章节
- 更丰富的细节和情感描写

### novel_processing_result.json
包含：
- 完整的处理结果（JSON格式）
- 所有阶段的详细信息和元数据

## 常见问题

### Q: 我的文件很大，会处理很久吗？
A: 处理时间取决于文件长度和API响应速度。长文本可能需要几分钟时间。

### Q: 可以处理中文小说吗？
A: 可以，系统支持UTF-8编码的中文文本。

### Q: 如果处理失败了怎么办？
A: 失败的章节会保存在 `failed/` 目录中，您可以手动检查或重新处理。

### Q: 可以修改prompts吗？
A: 可以，编辑 `prompts.yaml` 文件来自定义各个阶段的prompt。

### Q: 如何选择合适的模型？
A: 
- 摘要阶段建议使用GPT-4等强大模型
- 扩写阶段建议使用GPT-3.5-turbo等高效模型
- 可以在 `config.json` 中调整模型配置

## 下一步

1. 配置您的API密钥
2. 准备您的小说文本文件
3. 运行 `python novel_generator.py 您的文件.txt`
4. 查看生成的结果
5. 根据需要调整prompts或模型配置

祝您使用愉快！